{% comment %}
Related docs by group_id, ordered: Original → Direct Reprint → Truncated Reprint.
Format: VersionType: "Title," Creator
Links: title only → /items/:objectid.html
{% endcomment %}

{% if page.group_id %}
  {% assign all_items = site.data[site.metadata] %}
  {% assign group = all_items | where: "group_id", page.group_id %}
  {% if group and group.size > 1 %}
    <section class="related-documents">
      <h3 class="h5">Related Documents</h3>
      <ul>
        {% assign order = "Original|Direct Reprint|Truncated Reprint" | split: "|" %}

        {% comment %} # pass 1–3 in preferred order # {% endcomment %}
        {% for t in order %}
          {% for it in group %}
            {% if it.objectid != page.objectid and it.version_type == t %}
              {% assign t_clean = it.title | strip %}
              {% assign last = t_clean | slice: -1, 1 %}
              {% if last == ',' or last == '!' or last == '?' or last == ':' or last == ';' or last == '.' %}
                {% assign title_display = t_clean %}
              {% else %}
                {% assign title_display = t_clean | append: ',' %}
              {% endif %}
              <li>
                {{ it.version_type }}:
                <a href="{{ '/items/' | append: it.objectid | append: '.html' | relative_url }}">“{{ title_display }}”</a>
                {% if it.creator %} {{ it.creator }}{% endif %}
              </li>
            {% endif %}
          {% endfor %}
        {% endfor %}

        {% comment %} # pass 4: anything with other/blank version_type # {% endcomment %}
        {% for it in group %}
          {% unless order contains it.version_type %}
            {% if it.objectid != page.objectid %}
              {% assign t_clean = it.title | strip %}
              {% assign last = t_clean | slice: -1, 1 %}
              {% if last == ',' or last == '!' or last == '?' or last == ':' or last == ';' or last == '.' %}
                {% assign title_display = t_clean %}
              {% else %}
                {% assign title_display = t_clean | append: ',' %}
              {% endif %}
              <li>
                {{ it.version_type | default: 'Related' }}:
                <a href="{{ '/items/' | append: it.objectid | append: '.html' | relative_url }}">“{{ title_display }}”</a>
                {% if it.creator %} {{ it.creator }}{% endif %}
              </li>
            {% endif %}
          {% endunless %}
        {% endfor %}
      </ul>
    </section>
  {% endif %}
{% endif %}
