{% comment %}
Show other items that share this page's group_id.
Expects CSV fields: objectid, title, group_id, version_type
Order: Original → Full Reprint → Truncated Reprint → (anything else)
{% endcomment %}

{% if page.group_id %}
  {% assign all_items = site.data[site.metadata] %}
  {% assign group = all_items | where: "group_id", page.group_id %}

  {% if group and group.size > 1 %}
    <section class="related-documents mt-4">
      <h3 class="h5">Related Documents</h3>
      <ul class="mb-0">
        {%- assign types = "Original|Full Reprint|Truncated Reprint" | split: "|" -%}

        {%- comment -%} pass 1–3: preferred order {%- endcomment -%}
        {%- for t in types -%}
          {%- for it in group -%}
            {%- if it.objectid != page.objectid and it.version_type == t -%}
              <li>
                <a href="{{ '/items/' | append: it.objectid | relative_url }}">{{ it.title }}</a>
                {% if it.version_type %} ({{ it.version_type }}){% endif %}
              </li>
            {%- endif -%}
          {%- endfor -%}
        {%- endfor -%}

        {%- comment -%} pass 4: anything with a different/blank version_type {%- endcomment -%}
        {%- for it in group -%}
          {%- if it.objectid != page.objectid and types contains it.version_type == false -%}
            <li>
              <a href="{{ '/items/' | append: it.objectid | relative_url }}">{{ it.title }}</a>
              {% if it.version_type %} ({{ it.version_type }}){% endif %}
            </li>
          {%- endif -%}
        {%- endfor -%}
      </ul>
    </section>
  {% endif %}
{% endif %}
